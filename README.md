# EAC-multiome

This repository accompanies the work "[TBD]" (ref)
It contains all the code necessary to reproduce the analyses. 
Each subsection contains a README that contains a description of the path placeholders. 

## How to reproduce the analyses

To reproduce the analyses, one first needs to download the data available at XXX ([Instructions](link))

Then, one needs to run the scripts in order, as some intermediate files generated by the scripts will be re-used in subsequent scripts. 

For the snRNA-seq analysis, one needs to 
- run the preprocessing for each patient ([Instructions](link))
- run the preprocessing scripts for the external dataset to put them in the right format ([Instructions](link))
- run the analyses ([Instructions](link))
- run the pyscenic plus scripts ([Instructions](link))
- run the pyscenic scripts on external datasets ([Instructions](link))
- run the scripts for external validation ([Instructions](link))

For the snATAC-seq analysis, one needs to 
- run the prepocessing scripts ([Instructions](link))
- run BayesPrism for TCGA validation ([Instructions](link))

## Patient ID to sample ID mapping

In the original paper, for simplicity patients are referred to as P1 through P10. In the scripts/notebooks the patients are referred to using their sample ID. The mapping is provided below.
| Patient ID             | Sample ID                  |
|---------------------|--------------------------------|
| P1   | CCG1153_4496262   |
| P2   | CCG1153_6640539   |
| P3   | CCG1153_4411   |
| P4   | Aguirre_EGSFR0074   |
| P5   | Aguirre_EGSFR0148   |
| P6   | Aguirre_EGSFR1732   |
| P7   | Aguirre_EGSFR0128   |
| P8   | Aguirre_EGSFR1938   |
| P9   | Aguirre_EGSFR1982   |
| P10   | Aguirre_EGSFR2218   |

## Links to data used in the study

| Dataset             | Link to paper                  | Link to download                 | Remarks          | 
|---------------------|--------------------------------|---------------------------------|------------------|
| Discovery dataset    | [Yates et al., ???](TBD)    | [Download](http://example.com)  |     |
| Single-cell, Carroll et al.     | [Carroll et al., 2023](https://www.sciencedirect.com/science/article/pii/S1535610823002167?via%3Dihub)    | [Download](https://ega-archive.org/datasets/EGAD00001009401)  | Need to request access to data through EGA     |
| Bulk, Carroll et al., RNA   | [Carroll et al., 2023](https://www.sciencedirect.com/science/article/pii/S1535610823002167?via%3Dihub)    | [Download](https://ega-archive.org/datasets/EGAD00001009399)  | Need to request access to data through EGA  |
| Bulk, Carroll et al., Clinical   | [Carroll et al., 2023](https://www.sciencedirect.com/science/article/pii/S1535610823002167?via%3Dihub)     | [Download](https://bitbucket.org/licroxford/carroll_etal_2023/src/master/supplementary_files/Table_S8_papermetadata.xlsx)  | Inoperable cohort info is located [here](https://bitbucket.org/licroxford/carroll_etal_2023/src/master/supplementary_files/SuppInfo_OperablePts_LUD2015scRNAseq.xlsx)   |
| Single-cell, Croft et al.     | [Croft et al., 2022](https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-022-01666-x)    | [Download](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE222078)  | Need to request single-cell annotations from author (w.d.croft@bham.ac.uk)    |
| Bulk, Hoefnagel et al., RNA     | [Hoefnagel et al., 2022](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9496882/)    | [Download](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE207527)  |     |
| Bulk, Hoefnagel et al., Clinical     | [Hoefnagel et al., 2022](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9496882/)    | NA | Need to request from the author (sanne_hoefnagel@live.nl) |
| Bulk, TCGA, RNA (FPKM)| [The Cancer Genome Atlas Research Network, 2017](https://www.nature.com/articles/nature20805)    | [Download](https://xenabrowser.net/datapages/?dataset=TCGA-ESCA.htseq_fpkm-uq.tsv&host=https%3A%2F%2Fgdc.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443)  |  Used in the general TCGA analysis script  |
| Bulk, TCGA, RNA (Raw counts)| [The Cancer Genome Atlas Research Network, 2017](https://www.nature.com/articles/nature20805)    | [Download](https://xenabrowser.net/datapages/?dataset=TCGA-ESCA.htseq_counts.tsv&host=https%3A%2F%2Fgdc.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443)  |  Used as a basis to deconvolve for BayesPrism  |
| Bulk, TCGA, Clinical #1     | [The Cancer Genome Atlas Research Network, 2017](https://www.nature.com/articles/nature20805)    | [Download](https://xenabrowser.net/datapages/?dataset=TCGA-ESCA.GDC_phenotype.tsv&host=https%3A%2F%2Fgdc.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443)  | This is the general clinical+phenotypical info   |
| Bulk, TCGA, Clinical #2     | [The Cancer Genome Atlas Research Network, 2017](https://www.nature.com/articles/nature20805)  | [Download](https://static-content.springer.com/esm/art%3A10.1038%2Fnature20805/MediaObjects/41586_2017_BFnature20805_MOESM91_ESM.xlsx?_gl=1*mw3dke*_ga*OTAwNDk3MDU2LjE3MDg2ODk0Mzk.*_ga_B3E4QL2TPR*MTcxMDc3MDI1My4yMS4wLjE3MTA3NzAzNTcuMC4wLjA.)  | This is the clinical info provided in the original paper    |
| Bulk, TCGA, Clinical #3     | [The Cancer Genome Atlas Research Network, 2017](https://www.nature.com/articles/nature20805)  | [Download](https://xenabrowser.net/datapages/?dataset=TCGA-ESCA.survival.tsv&host=https%3A%2F%2Fgdc.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443)  | This is the survival information|

## Links to author data to download
| Data             | Needed for what script?                  | Description               | Link to download          | 
|---------------------|--------------------------------|---------------------------------|------------------|
| Gene Mapping    | R/scripts/BayesPrism/runBPrism.R    | Gene probe map fro the UCSC Xena browser that maps ENCODE to official gene ID |   [Download](https://github.com/ucscXena/xena-GDC-ETL/blob/master/xena_gdc_etl/resources/gencode.v22.annotation.gene.probeMap)  |
| GENCODE annotations   | python/notebooks/preprocessing-snRNA/XXXX.ipynb (where XXX is any sample name) | Subset of gencode annotations v41 |   [Download](TBD) or [link to original GTF file](https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_41/gencode.v41.annotation.gtf.gz)  |
| Gene Programs from Gavish et al.   | python/notebooks/analysis/cNMFCancerCells-perPatient.ipynb | Signature genes derived in the [Gavish et al. paper](https://www.nature.com/articles/s41586-023-06130-4) |   [Download](TBD) or [link to original Excel file](https://static-content.springer.com/esm/art%3A10.1038%2Fs41586-023-06130-4/MediaObjects/41586_2023_6130_MOESM6_ESM.xlsx), the .csv corresponds to the first sheet only |
| MSigDB Hallmarks of cancer GMT  | python/notebooks/analysis/cNMFCancerCells-perPatient.ipynb | This is the file to run GSEA on the hallmarks of cancer|   [Download](https://data.broadinstitute.org/gsea-msigdb/msigdb/release/7.4/h.all.v7.4.symbols.gmt) |

