# EAC-multiome

This folder contains all notebooks used for the analysis of the spatial transcriptomics (10X Visium) data of the subset of the discovery cohort. 

The information to download the counts for the datasets as well as all auxiliary files are located in the [related subsections of the README](https://github.com/vanallenlab/EAC-multiome/blob/main/README.md). Data that needs to be downloaded prior to running the scripts is indicated by the (**DWNL**) tag.

These notebooks should be run in the following order:

## 1. `Cell2Location.ipynb`

- `spatial_dir = pl.Path("/add/path/here/SpaceRanger_output/")`: path to the where the spatial data is saved (**DWNL**). Should contain one folder per sample named "sample_name".
- `ad_sc = sc.read_h5ad("/add/path/here/full_cohort.h5ad")`: path to where the full cleaned cohort `.h5ad` object was saved in [`tme-cleaning-analysis.ipynb`](https://github.com/vanallenlab/EAC-multiome/blob/main/code/python/notebooks/analysis/2.%20tme-cleaning-analysis.ipynb)
- `refined_annotations = pd.read_csv("/add/path/here/refined_annotations.csv",index_col=0)`: path to where the refined annotations derived from [`tme-cleaning-analysis.ipynb`](https://github.com/vanallenlab/EAC-multiome/blob/main/code/python/notebooks/analysis/2.%20tme-cleaning-analysis.ipynb) were saved. 
- `ref_run_name = "/add/path/here/Cell2Location_results/reference_signatures"`: path to where the Cell2Location results will be saved.
- `inf_aver.to_csv("/add/path/here/Cell2Location_results/mean-expression-per-celltype.csv")`: path to where to save the mean expression per cell type estimated by the NB model.

## **HERE the cell2loc scripts should be run** (see instructions [here](https://github.com/vanallenlab/EAC-multiome/tree/main/code/python/scripts/cell2loc))

## 2. `SpatialData_CNVanalysis.ipynb`

- `spatial_dir = pl.Path("/add/path/here/SpaceRanger_output/")`: path to the where the spatial data is saved (**DWNL**). Should contain one folder per sample named "sample_name".
- `cell2location_results_dir = pl.Path("/add/path/here/Cell2Location_results/")`: path to where the cell2location results were saved after running [`script-cell2loc.py`](https://github.com/vanallenlab/EAC-multiome/blob/main/code/python/scripts/cell2loc/script-cell2loc.py). 
- `figure_dir = pl.Path("/add/path/here/")`: path to where to save the produced figures.
- `visium_results_csv_dir = pl.Path("/add/path/here/visium_results_csv")`: path to where to save the results generated by the notebook.
- `gencode_df = pd.read_csv("/add/path/here/gencode_v41_chr_mapping.csv",index_col=0)`: this file is a subset of the Gencode annotation v41 that contains "seqname", "gene_name", "start", "end", "strand", and "gene_id". (**DWNL**)
- `signature_dir = pl.Path("/add/path/here/")`: path to where the marker genes for cNMF programs were saved in [`cNMFCancerCells-perPatient.ipynb`](https://github.com/vanallenlab/EAC-multiome/blob/main/code/python/notebooks/analysis/5.%20cNMFCancerCells-perPatient.ipynb)
- `caf_dir = pl.Path("/add/path/here/")`: path to where the marker genes for fibroblasts were saved in [`plotting-TME-subsets.ipynb`](https://github.com/vanallenlab/EAC-multiome/blob/main/code/python/notebooks/analysis/3.%20plotting-TME-subsets.ipynb)
- `myeloid_dir = pl.Path("/add/path/here/")`: path to where the marker genes for myeloid cells were saved in [`plotting-TME-subsets.ipynb`](https://github.com/vanallenlab/EAC-multiome/blob/main/code/python/notebooks/analysis/3.%20plotting-TME-subsets.ipynb)
- `interactions = pd.read_csv("/add/path/here/omnipath_intercell_network.csv",index_col=0)`: path to where the omnipath database of intercellular communications is saved, downloaded with [omnipath.interactions.import_intercell_network](https://omnipath.readthedocs.io/en/latest/api/omnipath.interactions.import_intercell_network.html#omnipath.interactions.import_intercell_network) (**DWNL**).

## 3. `SpatialData_NCEM.ipynb`

- `spatial_dir = pl.Path("/add/path/here/SpaceRanger_output/")`: path to the where the spatial data is saved (**DWNL**). Should contain one folder per patient named "patient_name".
- `cell2location_results_dir = pl.Path("/add/path/here/Cell2Location_results/")`: path to where the cell2location results were saved. 

